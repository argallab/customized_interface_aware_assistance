<?xml version="1.0"?>
<launch>

	<!-- INPUT METHOD -->
	<arg name="JOY" default="false" />
	<arg name="SNP" default="false" />
	<arg name="HA" default="false"/>
	<arg name="MS" default="false"/>
	<arg name="XM" default="false"/>
	<arg name="blending" default="false"/>
	<arg name="PS3" default="false"/>
	<arg name="JOINT" default="false"/>
	<arg name="DISP" default="true" />
	<arg name="DISP_PORT" default="/dev/mode_display_arduino" />
	<arg name="CHIN_PORT" default="/dev/chin_switch_arduino" />

	<rosparam param="snp_velocity_scale">10</rosparam>
	<rosparam param="joy_velocity_scale">10</rosparam>

	<!-- JOY NODES -->
	<!-- PS3 Joystick -->
	<group if="$(arg PS3)">
		<node pkg="joy" type="joy_node" name="joy_node_ps3">
			<param name="dev" value="/dev/ps3"/>
			<remap from="joy" to="joy_ps3"/>
		</node>
	</group>

	<!-- 3 Axis Joystick-->
	<group if="$(arg JOY)">
		<node pkg="joy" type="joy_node" name="joy_node_joystick" >
			<!-- <param name="dev" value="/dev/3_axis_joystick"/> -->
			<!--  TO DO:: FIX SIMLINK!!!!!! IMPORTANT -->
			<param name="dev" value="/dev/input/js0"/>
		</node>
		<node pkg="teleop_nodes" output="screen" type="joystick_node.py" name="joystick_node">
			<param name="joystick_paradigm" value="$(find teleop_nodes)/cfg/ModeSwitchParadigm.cfg"/>
		</node>
	</group>

	<!-- Sip and PUff -->
	<group if="$(arg SNP)">
		<rosparam command="load" file="$(find teleop_nodes)/config/sip_and_puff_mapping.yaml" />
		<rosparam command="load" file="$(find teleop_nodes)/config/velocity_limits.yaml" />
		<node pkg="joy" type="joy_node" name="joy_node_snp">
			<!-- <param name="dev" value="/dev/sip_and_puff"/> -->
			<param name="dev" value="/dev/input/js0"/>
			<!-- <remap from="joy" to="joy_sip_puff"/> -->
		</node>
		<node pkg="teleop_nodes" type="sip_puff_mapping.py" name="sip_puff_mapping"/>
		<node pkg="teleop_nodes" type="sip_and_puff_node.py" name="sip_and_puff_node" output="screen">
			<param name="snp_paradigm" value="$(find teleop_nodes)/cfg/SipPuffModeSwitchParadigm.cfg"/>
		</node>
		<node pkg="rosserial_python" name="chin_button_arduino" type="serial_node.py" args="$(arg CHIN_PORT)"/>
	</group>

	<!-- Mouse -->
	<group if="$(arg MS)">
		<include file="$(find joy_mouse)/launch/input_mouse.launch"/>
		<rosparam command="load" file="$(find joy_mouse)/config/mouse.yaml" ns="mouse_dev" />
		<node pkg="teleop_nodes" output="screen" type="mouse_node.py" name="mouse_node">
			<param name="mouse_paradigm" value="$(find teleop_nodes)/cfg/MouseModeSwitchParadigm.cfg"/>
		</node>
	</group>

  <!-- Headarray -->
	<group if="$(arg HA)">
		<node pkg="teleop_nodes" type="headarray_node.py" name="headarray_node" output="screen">
			<param name="headarray_paradigm" value="$(find teleop_nodes)/cfg/HeadarrayModeSwitchParadigm.cfg"/>
		</node>
		<include file="$(find joy_mouse)/launch/input_mouse.launch">
			<arg name="DEV" value="Dachris"/>
	  </include>
		<rosparam command="load" file="$(find joy_mouse)/config/headarray.yaml" ns="mouse_dev" />
		<node pkg="rosserial_python" name="chin_button_arduino" type="serial_node.py" args="$(arg CHIN_PORT)" />
	</group>



	<!-- TELEOP NODE -->
	<!-- Pure teleop (no blending) -->
	<!-- <group unless="$(arg blending)">
		<node pkg="teleop_nodes" output="screen" type="uservel_to_cartesianvel.py" name="uservel_to_cartesianvel"/>
	</group> -->


	<!-- Mode Display -->
	<group if="$(arg DISP)">
		<node pkg="rosserial_python" name="mode_display_arduino" type="serial_node.py" args="$(arg DISP_PORT)" />
		<!-- FIX THIS: This loads too fast, before service is ready in teleop node -->
		<node pkg="rqt_reconfigure" type="rqt_reconfigure" name="mode_paradigm_control"/>
		<rosparam param="is_joint" subst_value="True">$(arg JOINT)</rosparam>
	</group>
</launch>
